

===== 单点登录


.简介
. 传统登陆, 用户登陆后, 在客户端保存一个cookie在服务器保存一个session.
处理用户请求时, 从session获得用户信息
. 在分布式系统中, 一个网站可能部署在多台服务器上.
要保证用户只需要在该网站登陆一次, 之后每次访问该网站的不同微服务,
都能获取到该请求的用户信息


.登陆原理
. 客户端发出访问需要验证用户信息的网址的请求时,
微服务如果判断用户没有的登陆
.. 就重定向到认证中心, 让用户的登陆.
... 重定向时, 记录用户请求微服务地址, 在登陆成功后重定向回来
.. 认证中心验证用户账号密码正确, 就在认证中心生成用户session,
并给浏览器添加登陆凭证ticket
.. 重定向回用户访问的微服务地址
. 微服务判断如果请求中包含登陆凭证ticket, 则向认证中心验证ticket是否有效.
.. 验证请求的service地址和ticket是否和认证中心登记的一致
.. 如果有效, 认证中心将获得用户信息, 微服务创建一个session用来保存用户信息
. 当客户端再次访问时, 微服务不需要再请求认证中心, 同过session判断已经登陆,
并获取用户信息


.登出原理
. 认证中心在认证ticket有效, 并向service发放用户session时,
需要记录service地址和sessionid.
. 在任意一个service请求登出时, 都将请求重定向到认证中心
. 认证中心删除本地和记录中的service上该用户的session


.优点
. 安全性高
.. 客户端访问多个service时, 都需要不同的session与之对应
... 比如, 有一个支付系统部署在5台服务器上.
黑客连接到了用户的一次支付请求, 根据请求中的session模拟一个支付请求.
请求到正好匹配这个session的service的概率就是1/5, 大概率会失败
. 减少网络请求
.. 用户信息作为session存储在每台服务器上, 减少了网络请求, 提高了响应时间
.. 每次service获取session时都需要与认证中心通信, 当service集群非常多时,
每个请求都有可能需要获取session, 产生大量网络消耗.
所以通常将session过期时间设置为7天到一个月