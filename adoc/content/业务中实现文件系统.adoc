

===== 业务中实现文件系统


.文件上传
. 有两张表, 一张上传进度表, 一张文件信息表
. 先由前端计算出文件的MD5
. 第一次请求, 通过MD5和文件名判断这个文件是否在文件信息表中保存过.
通过MD5判断文件是否上传过.
.. 已经上传成功的直接返回文件id.
通过文件可以请求到实际文件
.. 没有上传过则创建上传记录
.. 有上传记录的, 返回上传偏移量
. 前端第二次请求时上传文件, 前端可以将文件分为多块上传
.. 将上传的文件保存在本地硬盘中
.. 分割后的文件每块上传成功时在上传进度表中增加偏移量.
当偏移量等于文件大小时文件上传成功
. 上传文件的处理
.. 如果重复上传相同的文件, 但文件名不一样.
不再保存相同的文件, 只在文件信息表中增加一条记录, 关联文件id和新的文件名
.. 如果是图片文件, 则在上传成功后, 对图片压缩, 同时保存原图和压缩图片.
图片压缩使用了谷歌开源的Thumbnailator


.文件下载
通过文件信息表的id找到关联的GridFS文件id, 调用GridFsTemplate API进行下载