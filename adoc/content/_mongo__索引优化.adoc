

==== 索引优化

.mongodb的索引
. 没有索引的字段放到索引字段前面, 是否会影响查询性能
.. 不考虑数据映射时
... 增加了没有索引的字段, 查询结果增加了多倍, 但是响应速度反而降低了
... 增加的没有索引字段在前或在后没有差别
.. 考虑数据映射时
... 返回数据量巨大时, 映射耗时远超查询耗时
. 对排序字段建索引没用
.. 不过官方文档说有用, 可能没测到适用的情况
. 查询扫描文档数直接影响查询耗时
. 使用or时走索引的情况
.. 索引字段在or前面, 则正常匹配索引
.. 索引字段在or前面有, 里面也有一个, 则正常走索引
... 复合索引: c_n_idx [company_id, orderId]
+
[source,js]
----
db.wf_task.find({ company_id: '10509',
    orderId: '5d64f34dd795867a2c3913ef',
    $or: [{
        order_process_Name: 'N89f2e30f86964fd48b1d6c4620d0163b'
    }, {
        'order_creator._id': '10812'
    }]
}).explain()
----

... or内的字段顺序不影响是否走索引
.. 索引字段都在or里, 一个索引都不走
.. 索引字段如果在or里面, or条件要放在最后. 因为or条件后面的字段连不上or和or前面的索引字段
... 复合索引的字段为:  companyId, name
+
[source,js]
----
db.tabl_user.find({
    $or: [{
        companyId: '7000'
    }, {
        age: 0
    }],
    name: '阮航7'
})
----

. 排序会有明显的性能消耗, 不需要排序时, 应不使用默认排序字段
. 模糊搜索regex
.. 模糊搜索也会走索引. 与mysql不一样, 全模糊也走索引
. 查询条件中有主键, 默认会优化只走主键索引
. 不等于也会走索引
. 对有空值的字段建索引
.. 查询有空值的字段依然会走索引

